function u(){throw new Error("Failed pattern match")}function j(t,n){return n>0?Math.floor(t/n):n<0?-Math.floor(t/-n):0}var le=function(t){return function(n){return function(){return t(n())}}},_e=function(t){return function(){return t}};var zn={map:le};var Qn={apply:t=>n=>()=>{let r=t(),a=n();return It.pure(r(a))()},Functor0:()=>zn},It={pure:_e,Apply0:()=>Qn};var qt=function(t){return function(n){return t+n|0}};var J=function(t){return function(n){if(n===0)return 0;var r=Math.abs(n);return(t%r+r)%r}};var E=function(t){throw new Error(t)};var c=(t,n,r)=>({tag:t,_1:n,_2:r});var Kt=t=>c("HalfWord",t);var Ie=["G","A","S","M"],Se=t=>{if(t.tag==="Byte")return[t._1];if(t.tag==="HalfWord")return[J(t._1)(256),j(t._1,256)];if(t.tag==="Word"){let n=j(t._1,65536),r=J(t._1)(65536);return[J(r)(256),j(r,256),J(n)(256),j(n,256)]}return t.tag==="NamedLabel"?[J(t._1)(256),j(t._1,256),J(t._2)(256),j(t._2,256)]:E("Impossible")},Jt=t=>{if(t.tag==="Byte")return 1;if(t.tag==="HalfWord")return 2;if(t.tag==="Word"||t.tag==="NamedLabel"||t.tag==="Sym")return 4;u()};var he=function(t){return function(n){return t===n}};var Ge=he;var Re=he;var Me={eq:Re};var Ot={eq:Ge};var Wt=t=>t,F=Wt("LT"),q=Wt("GT"),U=Wt("EQ");var we=function(t){return function(n){return function(r){return function(a){return function(e){return a<e?t:a===e?n:r}}}}};var Ce=we;var Ae=we;var bt={compare:Ae(F)(U)(q),Eq0:()=>Me};var ot={compare:Ce(F)(U)(q),Eq0:()=>Ot};var Hn={eq:t=>n=>t===n},Mt={compare:t=>n=>ot.compare(t)(n),Eq0:()=>Hn};var C=function(t){return function(n){for(var r=n.length,a=new Array(r),e=0;e<r;e++)a[e]=t(n[e]);return a}};var Le=t=>t;var kt=function(t){return function(n){for(var r=[],a=0,e=t.length;a<e;a++)Array.prototype.push.apply(r,n(t[a]));return r}};var G=(t,n)=>({tag:t,_1:n}),f=G("Nothing"),K=t=>G("Just",t);var dt={map:t=>n=>n.tag==="Just"?G("Just",t(n._1)):f};var ut=(t,n)=>({tag:t,_1:n});var qe=t=>t;var Ut={map:t=>n=>t(n)};var Pe={apply:t=>n=>t(n),Functor0:()=>Ut},dr={bind:t=>n=>n(t),Apply0:()=>Pe},ur={pure:qe,Apply0:()=>Pe},tt={Applicative0:()=>ur,Bind1:()=>dr};var et=(t,n)=>({tag:t,_1:n});var Ke={tailRecM:t=>{let n=r=>{let a=r,e=!0,o;for(;e;){let i=a;if(i.tag==="Loop"){a=t(i._1);continue}if(i.tag==="Done"){e=!1,o=i._1;continue}u()}return o};return r=>n(t(r))},Monad0:()=>tt};var Je=function(n){return function(r){return function(a){return function(){return n(r,a)}}}};var Oe=function(t,n){return n.push(t)};var xe=Je(Oe);var Vt=function(t){return function(n){return function(r){for(var a=n,e=r.length,o=e-1;o>=0;o--)a=t(r[o])(a);return a}}},x=function(t){return function(n){return function(r){for(var a=n,e=r.length,o=0;o<e;o++)a=t(a)(r[o]);return a}}};var Yt=t=>t;var ke=t=>{let n=t.Apply0();return r=>a=>r.foldr(e=>{let o=a(e);return i=>n.apply(n.Functor0().map(d=>Le)(o))(i)})(t.pure())},Ue=t=>{let n=ke(t);return r=>{let a=n(r);return e=>o=>a(o)(e)}};var ze={foldr:t=>n=>r=>{if(r.tag==="Nothing")return n;if(r.tag==="Just")return t(r._1)(n);u()},foldl:t=>n=>r=>{if(r.tag==="Nothing")return n;if(r.tag==="Just")return t(n)(r._1);u()},foldMap:t=>{let n=t.mempty;return r=>a=>{if(a.tag==="Nothing")return n;if(a.tag==="Just")return r(a._1);u()}}};var nt={foldr:Vt,foldl:x,foldMap:t=>{let n=t.mempty;return r=>nt.foldr(a=>e=>t.Semigroup0().append(r(a))(e))(n)}};var l=(t,n)=>({tag:"Tuple",_1:t,_2:n});var _t=function(t){return t};var en={traverse:t=>n=>r=>{if(r.tag==="Nothing")return t.pure(f);if(r.tag==="Just")return t.Apply0().Functor0().map(K)(n(r._1));u()},sequence:t=>n=>{if(n.tag==="Nothing")return t.pure(f);if(n.tag==="Just")return t.Apply0().Functor0().map(K)(n._1);u()},Functor0:()=>dt,Foldable1:()=>ze};var Pr=function(t,n){if(t<1)return[];var r=new Array(t);return r.fill(n)},Br=function(t,n){for(var r=[],a=0,e=0;e<t;e++)r[a++]=n;return r},Kr=typeof Array.prototype.fill=="function"?Pr:Br;var mt=function(t,n,r){return r.length===0?t({}):n(r[0])(r.slice(1))};var Ct=function(t,n,r,a){for(var e=0,o=a.length;e<o;e++)if(r(a[e]))return t(e);return n};var At=function(t,n,r){return r.slice(t,n)};var Q=t=>n=>(()=>{let r=xe(n);return()=>{let a=[...t];return r(a)(),a}})()();var vt=t=>{let n=t.length-1|0;return n>=0&&n<t.length?G("Just",t[n]):f};var Jr=t=>n=>kt(n)(t),rn=t=>Jr(n=>{let r=t(n);if(r.tag==="Nothing")return[];if(r.tag==="Just")return[r._1];u()});function on(t){return t.buffer}function W(t){return function(r,a,e){if(a===null)return new t(r);var o=r.byteLength,i=t.BYTES_PER_ELEMENT,d=Math.min(o,a>>>0);if(e===null)return new t(r,d);var $=Math.min((o-d)/i,e);return new t(r,d,$)}}var xr=W(Uint8ClampedArray),Wr=W(Uint32Array),jr=W(Uint16Array),kr=W(Uint8Array),Ur=W(Int32Array),zr=W(Int16Array),ne=W(Int8Array),Qr=W(Float32Array),Vr=W(Float64Array);var A$=Number.POSITIVE_INFINITY,T$=Number.NEGATIVE_INFINITY;function ct(t){return t.charCodeAt(0)}var p=(t,n,r)=>({tag:t,_1:n,_2:r});var V=p("Nil");var Y=(t,n,r,a,e,o,i)=>({tag:t,_1:n,_2:r,_3:a,_4:e,_5:o,_6:i});var X=Y("Leaf");var R=(t,n,r,a)=>{if(r.tag==="Leaf"){if(a.tag==="Leaf")return Y("Node",1,1,t,n,r,a);if(a.tag==="Node")return Y("Node",1+a._1|0,1+a._2|0,t,n,r,a);u()}if(r.tag==="Node"){if(a.tag==="Leaf")return Y("Node",1+r._1|0,1+r._2|0,t,n,r,a);if(a.tag==="Node")return Y("Node",r._1>a._1?1+r._1|0:1+a._1|0,(1+r._2|0)+a._2|0,t,n,r,a)}u()};var $n=(t,n,r,a)=>{if(r.tag==="Leaf")return a.tag==="Leaf"?Y("Node",1,1,t,n,X,X):a.tag==="Node"&&a._1>1?a._5.tag==="Node"&&(()=>{if(a._6.tag==="Leaf")return a._5._1>0;if(a._6.tag==="Node")return a._5._1>a._6._1;u()})()?R(a._5._3,a._5._4,R(t,n,r,a._5._5),R(a._3,a._4,a._5._6,a._6)):R(a._3,a._4,R(t,n,r,a._5),a._6):R(t,n,r,a);if(r.tag==="Node")return a.tag==="Node"?a._1>(r._1+1|0)?a._5.tag==="Node"&&(()=>{if(a._6.tag==="Leaf")return a._5._1>0;if(a._6.tag==="Node")return a._5._1>a._6._1;u()})()?R(a._5._3,a._5._4,R(t,n,r,a._5._5),R(a._3,a._4,a._5._6,a._6)):R(a._3,a._4,R(t,n,r,a._5),a._6):r._1>(a._1+1|0)?r._6.tag==="Node"&&(()=>{if(r._5.tag==="Leaf")return 0<=r._6._1;if(r._5.tag==="Node")return r._5._1<=r._6._1;u()})()?R(r._6._3,r._6._4,R(r._3,r._4,r._5,r._6._5),R(t,n,r._6._6,a)):R(r._3,r._4,r._5,R(t,n,r._6,a)):R(t,n,r,a):a.tag==="Leaf"&&r._1>1?r._6.tag==="Node"&&(()=>{if(r._5.tag==="Leaf")return 0<=r._6._1;if(r._5.tag==="Node")return r._5._1<=r._6._1;u()})()?R(r._6._3,r._6._4,R(r._3,r._4,r._5,r._6._5),R(t,n,r._6._6,a)):R(r._3,r._4,r._5,R(t,n,r._6,a)):R(t,n,r,a);u()};var ae=t=>n=>a=>{let e=a,o=!0,i;for(;o;){let d=e;if(d.tag==="Leaf"){o=!1,i=f;continue}if(d.tag==="Node"){let $=t.compare(n)(d._3);if($==="LT"){e=d._5;continue}if($==="GT"){e=d._6;continue}if($==="EQ"){o=!1,i=G("Just",d._4);continue}}u()}return i};var Tt=t=>n=>r=>{let a=e=>{if(e.tag==="Leaf")return Y("Node",1,1,n,r,X,X);if(e.tag==="Node"){let o=t.compare(n)(e._3);if(o==="LT")return $n(e._3,e._4,a(e._5),e._6);if(o==="GT")return $n(e._3,e._4,e._5,a(e._6));if(o==="EQ")return Y("Node",e._1,e._2,n,r,e._5,e._6)}u()};return a};var cn=function(t){return function(n){return t.length===0?n:n.length===0?t:t.concat(n)}};var sn={append:cn};var oe={mempty:[],Semigroup0:()=>sn};var Nt=function(t){return t.split("")};var ie=Ue(It)(nt),pn=x(qt)(0),ft=nt.foldMap(oe)(Yt),$a=nt.foldMap(oe);var ln=t=>n=>r=>{let a=(e,o)=>{let i=ae(Mt)(o)(n);return i.tag==="Just"?[c("Byte",e),c("HalfWord",i._1-t|0)]:E("Impossible")};return e=>{if(e.tag==="KNoop")return[c("Byte",254)];if(e.tag==="KStop")return[c("Byte",255)];if(e.tag==="KLabel")return[];if(e.tag==="KQuote"){if(e._1.tag==="CstBool")return e._1._1?[c("Byte",192),c("Byte",1)]:[c("Byte",192),c("Byte",0)];if(e._1.tag==="CstInt")return[c("Byte",193),c("Word",e._1._1)];u()}if(e.tag==="KGetGlobal")return[c("Byte",200),c("Sym",e._1)];if(e.tag==="KSetGlobal")return[c("Byte",201),c("Sym",e._1)];if(e.tag==="KField")return[c("Byte",202),c("Byte",e._1)];let o=i=>{if(e.tag==="KClosure")return E("Impossible");if(e.tag==="KApply")return[c("Byte",129)];if(e.tag==="KPush")return[c("Byte",131)];if(e.tag==="KPushMark")return[c("Byte",132)];if(e.tag==="KGrab")return[c("Byte",133)];if(e.tag==="KReturn")return[c("Byte",96)];if(e.tag==="KTailApply")return[c("Byte",102)];if(e.tag==="KAccess")return[c("Byte",225),c("Byte",e._1)];if(e.tag==="KLet")return[c("Byte",226)];if(e.tag==="KEndLet")return[c("Byte",227),c("Byte",e._1)];if(e.tag==="KDummies")return[c("Byte",228),c("Byte",e._1)];if(e.tag==="KUpdate")return[c("Byte",229),c("Byte",e._1)];if(e.tag==="K_i32_add")return[c("Byte",161)];if(e.tag==="K_i32_sub")return[c("Byte",162)];if(e.tag==="K_i32_mul")return[c("Byte",163)];if(e.tag==="K_i32_div")return[c("Byte",164)];if(e.tag==="K_i32_mod")return[c("Byte",165)];if(e.tag==="K_i32_equ")return[c("Byte",166)];if(e.tag==="K_i32_neq")return[c("Byte",167)];if(e.tag==="K_i32_le")return[c("Byte",168)];if(e.tag==="K_i32_lt")return[c("Byte",169)];if(e.tag==="K_log_and")return[c("Byte",170)];if(e.tag==="K_log_or")return[c("Byte",171)];if(e.tag==="K_log_xor")return[c("Byte",172)];if(e.tag==="K_log_not")return[c("Byte",173)];if(e.tag==="KBranch")return a(176,e._1);if(e.tag==="KBranchIf")return a(177,e._1);if(e.tag==="KBranchIfNot")return a(178,e._1);u()};if(e.tag==="KClosure"){let i=e._1,d=Ct(K,f,$=>$===i,r);if(d.tag==="Just")return[c("Byte",128),c("NamedLabel",d._1,t)]}return o(!0)}},_n=t=>{let n=(()=>{let a=X,e=0,o=[];ie(t.text)($=>{let g=$._1.code,h=$._1.lbl,M=x(w=>{let N=w._2,s=w._1;return y=>y.tag==="KLabel"?l(s,Tt(Mt)(y._1)(s)(N)):l((()=>{if(y.tag==="KLabel")return s+0|0;if(y.tag==="KQuote"){if(y._1.tag==="CstBool")return s+2|0;if(y._1.tag==="CstInt")return s+5|0;u()}return y.tag==="KGetGlobal"||y.tag==="KSetGlobal"?s+5|0:y.tag==="KField"||y.tag==="KAccess"?s+2|0:y.tag==="KClosure"?s+5|0:y.tag==="KEndLet"||y.tag==="KDummies"||y.tag==="KUpdate"?s+2|0:y.tag==="KBranch"||y.tag==="KBranchIf"||y.tag==="KBranchIfNot"?s+3|0:s+1|0})(),N)})(l(0,X))(g)._2;return()=>{let w=e,N=a;return a=Tt(bt)(h)(w)(N),ie(g)(s=>()=>{let y=e;o.push(...ln(y)(M)(C(_t)(t.syms))(s));let I=e;return e=(()=>{if(s.tag==="KLabel")return I+0|0;if(s.tag==="KQuote"){if(s._1.tag==="CstBool")return I+2|0;if(s._1.tag==="CstInt")return I+5|0;u()}return s.tag==="KGetGlobal"||s.tag==="KSetGlobal"?I+5|0:s.tag==="KField"||s.tag==="KAccess"?I+2|0:s.tag==="KClosure"?I+5|0:s.tag==="KEndLet"||s.tag==="KDummies"||s.tag==="KUpdate"?I+2|0:s.tag==="KBranch"||s.tag==="KBranchIf"||s.tag==="KBranchIfNot"?I+3|0:I+1|0})()})()}})();let i=[...o];return l(a,i)})(),r=n._1;return{header:{name:t.name,compilerVersion:"v0.1.0"},text:[...rn(a=>a)(C(a=>{let e=ae(bt)(a)(r);return e.tag==="Just"?G("Just",c("HalfWord",e._1)):f})(t.syms)),...n._2],entry:(()=>{let a=x(e=>{let o=e._2,i=e._1;return d=>d.tag==="KLabel"?l(i,Tt(Mt)(d._1)(i)(o)):l((()=>{if(d.tag==="KLabel")return i+0|0;if(d.tag==="KQuote"){if(d._1.tag==="CstBool")return i+2|0;if(d._1.tag==="CstInt")return i+5|0;u()}return d.tag==="KGetGlobal"||d.tag==="KSetGlobal"?i+5|0:d.tag==="KField"||d.tag==="KAccess"?i+2|0:d.tag==="KClosure"?i+5|0:d.tag==="KEndLet"||d.tag==="KDummies"||d.tag==="KUpdate"?i+2|0:d.tag==="KBranch"||d.tag==="KBranchIf"||d.tag==="KBranchIfNot"?i+3|0:i+1|0})(),o)})(l(0,X))(t.init)._2;return()=>{let e=0,o=[];return ie(t.init)(i=>()=>{let d=e;o.push(...ln(d)(a)(C(_t)(t.syms))(i));let $=e;return e=(()=>{if(i.tag==="KLabel")return $+0|0;if(i.tag==="KQuote"){if(i._1.tag==="CstBool")return $+2|0;if(i._1.tag==="CstInt")return $+5|0;u()}return i.tag==="KGetGlobal"||i.tag==="KSetGlobal"?$+5|0:i.tag==="KField"||i.tag==="KAccess"?$+2|0:i.tag==="KClosure"?$+5|0:i.tag==="KEndLet"||i.tag==="KDummies"||i.tag==="KUpdate"?$+2|0:i.tag==="KBranch"||i.tag==="KBranchIf"||i.tag==="KBranchIfNot"?$+3|0:$+1|0})()})(),[...o]}})()(),syms:C(_t)(t.syms)}},mn=t=>{let n=ft([[...C(a=>c("Byte",ct(a)))(Nt(t.header.name)),c("Byte",0)],[...C(a=>c("Byte",ct(a)))(Nt(t.header.compilerVersion)),c("Byte",0)]]),r=$a(a=>Se((()=>{if(a.tag==="Sym"){let e=a._1,o=Ct(K,f,i=>i===e,t.syms);if(o.tag==="Just")return c("Word",o._1)}return a.tag==="Sym"?E("Impossible: undefined symbol"):a})()))(ft([ft([C(a=>c("Byte",ct(a)))(Ie),[c("Byte",5+n.length|0)],n]),ft((()=>{let a=[t.text,t.entry,[c("HalfWord",t.syms.length),...ft((()=>{let o=C(d=>[...C($=>c("Byte",ct($)))(Nt(d)),c("Byte",0)])(t.syms),i=C(Kt)(x(d=>$=>{let g=vt(d);return Q(d)((()=>{if(g.tag==="Just")return g._1;u()})()+pn(C(Jt)($))|0)})([0])(o));return[(i.length===0&&u(),At(0,i.length-1|0,i)),...o]})())]],e=C(Kt)(x(o=>i=>{let d=vt(o);return Q(o)((()=>{if(d.tag==="Just")return d._1;u()})()+pn(C(Jt)(i))|0)})([0])(a));return[(e.length===0&&u(),At(0,e.length-1|0,e)),...a]})())]));return()=>{let a=ne(r,null,null);return on(a)}};var gt=t=>({bind:n=>r=>a=>t.Bind1().bind(n(a))(e=>r(e._1)(e._2)),Apply0:()=>Lt(t)}),Lt=t=>{let n=t.Bind1().Apply0().Functor0(),r={map:a=>e=>o=>n.map(i=>l(a(i._1),i._2))(e(o))};return{apply:(()=>{let a=gt(t);return e=>o=>a.bind(e)(i=>a.bind(o)(d=>Dt(t).pure(i(d))))})(),Functor0:()=>r}},Dt=t=>({pure:n=>r=>t.Applicative0().pure(l(n,r)),Apply0:()=>Lt(t)});var fn=t=>{let n=t.Monad0(),r={Applicative0:()=>Dt(n),Bind1:()=>gt(n)};return{tailRecM:a=>e=>o=>t.tailRecM(i=>n.Bind1().bind(a(i._1)(i._2))(d=>n.Applicative0().pure((()=>{if(d._1.tag==="Loop")return et("Loop",l(d._1._1,d._2));if(d._1.tag==="Done")return et("Done",l(d._1._1,d._2));u()})())))(l(e,o)),Monad0:()=>r}},gn=t=>{let n={Applicative0:()=>Dt(t),Bind1:()=>gt(t)};return{state:r=>a=>t.Applicative0().pure(r(a)),Monad0:()=>n}};var yt=(t,n)=>({tag:t,_1:n});var _=(t,n,r)=>({tag:t,_1:n,_2:r});var Dn=_("KStop");var yn=_("KApply"),In=_("KTailApply"),Sn=_("KGrab"),Et=_("KPush"),hn=_("KPushMark"),ue=_("KReturn");var Gn=_("KLet");var Rn=_("K_i32_add"),bn=_("K_i32_sub"),Mn=_("K_i32_mul"),wn=_("K_i32_div"),Cn=_("K_i32_mod"),An=_("K_i32_equ"),Tn=_("K_i32_neq"),Nn=_("K_i32_le"),Ln=_("K_i32_lt"),En=_("K_log_and"),Fn=_("K_log_or"),qn=_("K_log_xor"),Pn=_("K_log_not");var Kn=t=>({tag:"CodeSection",_1:t});var rt=gn(tt),S=gt(tt),ce=rt.state(t=>l(t,t)),A=Dt(tt),fa=Lt(tt).apply,ga=fn(Ke).tailRecM;var $e=S.bind(ce)(t=>{let n=t.next;return S.bind((()=>{let r={...t,next:n+1|0};return rt.state(a=>l(void 0,r))})())(()=>A.pure(n))}),On=t=>(r=>a=>{let e=r,o=a,i=!0,d;for(;i;){let $=e,g=o;if($===0){i=!1,d=g;continue}e=$-1|0,o=p("Cons",Sn,g)}return d})(t),Da=t=>{if(t.tag==="Cons"){if(t._1.tag==="KReturn")return A.pure(l(ue,t));if(t._1.tag==="KBranch")return A.pure(l(t._1,t))}return S.bind($e)(n=>A.pure(l(_("KBranch",n),p("Cons",_("KLabel",n),t))))};var ya=t=>n=>r=>S.bind(ce)(a=>{let e={...a,more:p("Cons",{lbl:t,arity:n,term:r},a.more)};return rt.state(o=>l(void 0,e))}),Jn=t=>{let n=e=>o=>{if(e.tag==="ELVar")return A.pure(p("Cons",_("KAccess",e._2),o));if(e.tag==="ELConst")return A.pure(p("Cons",_("KQuote",e._2),o));if(e.tag==="ELApp"&&o.tag==="Cons"&&o._1.tag==="KReturn")return S.bind(n(e._2)(p("Cons",In,o._2)))(i=>a(e._3)(p("Cons",Et,i)));if(e.tag==="ELApp"){let i=e._3;return S.bind(n(e._2)(p("Cons",yn,o)))(d=>{let $=a(i)(p("Cons",Et,d));return g=>{let h=$(g);return l(p("Cons",hn,h._1),h._2)}})}if(e.tag==="ELAbs"){if(o.tag==="Cons"&&o._1.tag==="KReturn"){let $=On(e._2),g=n(e._3)(o);return h=>{let M=g(h);return l($(M._1),M._2)}}let i=e._2,d=e._3;return S.bind($e)($=>S.bind(ya($)(i)(d))(()=>A.pure(p("Cons",_("KClosure",t,$),o))))}if(e.tag==="ELLet"){let i=e._2;return S.bind(n(e._3)(o.tag==="Cons"&&o._1.tag==="KReturn"?o:p("Cons",_("KEndLet",i.length),o)))(d=>{let $=g=>{let h=mt(M=>f,M=>w=>G("Just",{head:M,tail:w}),g);if(h.tag==="Nothing")return A.pure(d);if(h.tag==="Just"){let M=h._1.head;return S.bind((()=>{let w=$(h._1.tail);return N=>{let s=w(N);return l(p("Cons",Gn,s._1),s._2)}})())(w=>n(M)(w))}u()};return $(i)})}return e.tag==="ELPrim"?e._2.tag==="PGetGlobal"?A.pure(p("Cons",_("KGetGlobal",e._2._1),o)):e._2.tag==="PSetGlobal"&&e._3.length===1?n(e._3[0])(p("Cons",_("KSetGlobal",e._2._1),o)):e._2.tag==="PSetGlobal"?E("Impossible"):a(e._3)(e._2.tag==="PAccess"?p("Cons",_("KAccess",e._2._1),o):e._2.tag==="P_i32_add"?p("Cons",Rn,o):e._2.tag==="P_i32_sub"?p("Cons",bn,o):e._2.tag==="P_i32_mul"?p("Cons",Mn,o):e._2.tag==="P_i32_div"?p("Cons",wn,o):e._2.tag==="P_i32_mod"?p("Cons",Cn,o):e._2.tag==="P_i32_equ"?p("Cons",An,o):e._2.tag==="P_i32_neq"?p("Cons",Tn,o):e._2.tag==="P_i32_le"?p("Cons",Nn,o):e._2.tag==="P_i32_lt"?p("Cons",Ln,o):e._2.tag==="P_log_and"?p("Cons",En,o):e._2.tag==="P_log_or"?p("Cons",Fn,o):e._2.tag==="P_log_not"&&o.tag==="Cons"&&o._1.tag==="KBranchIf"?p("Cons",_("KBranchIfNot",o._1._1),o._2):e._2.tag==="P_log_not"&&o.tag==="Cons"&&o._1.tag==="KBranchIfNot"?p("Cons",_("KBranchIf",o._1._1),o._2):e._2.tag==="P_log_not"?p("Cons",Pn,o):e._2.tag==="P_log_xor"?p("Cons",qn,o):E("Impoissible")):e.tag==="ELIf"?r(e._2)(e._3)(e._4)(o):E("Not Implemented")},r=e=>o=>i=>d=>S.bind(Da(d))($=>{let g=$._1,h=$._2;return S.bind($e)(M=>S.bind(n(i)(h))(w=>S.bind(n(o)(p("Cons",g,p("Cons",_("KLabel",M),w))))(N=>n(e)(p("Cons",_("KBranchIfNot",M),N)))))}),a=e=>o=>{let i=mt(d=>f,d=>$=>G("Just",{head:d,tail:$}),e);if(i.tag==="Nothing")return A.pure(o);if(i.tag==="Just"&&i._1.tail.length===0)return n(i._1.head)(o);if(i.tag==="Just"){let d=i._1.tail;return S.bind(n(i._1.head)(o))($=>a(d)(p("Cons",Et,$)))}u()};return n},Ia=t=>{let n=t.ident,r=rt.state(d=>l(void 0,{...d,next:0})),a=S.bind(ce)(d=>en.traverse(A)($=>{let g=$.head;return S.bind((()=>{let h={...d,more:$.tail};return rt.state(M=>l(void 0,h))})())(()=>A.pure(g))})((()=>{if(d.more.tag==="Nil")return f;if(d.more.tag==="Cons")return G("Just",{head:d.more._1,tail:d.more._2});u()})())),e=d=>S.bind(a)($=>{if($.tag==="Just"){let g=$._1;return S.bind(Jn(n)(g.term)(p("Cons",ue,d)))(h=>g.arity===1?e(p("Cons",_("KLabel",g.lbl),h)):e(p("Cons",_("KLabel",g.lbl),On(g.arity-1|0)(h))))}if($.tag==="Nothing")return A.pure(d);u()}),o=S.bind(e(V))(d=>A.pure(Kn({lbl:n,code:(g=>h=>{let M=g,w=h,N=!0,s;for(;N;){let y=M,I=w;if(I.tag==="Nil"){N=!1,s=y;continue}if(I.tag==="Cons"){M=Q(y)(I._1),w=I._2;continue}u()}return s})([])(d)}))),i=S.bind(Jn(n)(t.term)(n==="it"?p("Cons",Dn,V):p("Cons",_("KSetGlobal",n),V)))(d=>A.pure((g=>h=>{let M=g,w=h,N=!0,s;for(;N;){let y=M,I=w;if(I.tag==="Nil"){N=!1,s=y;continue}if(I.tag==="Cons"){M=Q(y)(I._1),w=I._2;continue}u()}return s})([])(d)));return S.bind(rt.state(d=>l(void 0,{...d,more:V})))(()=>S.bind(r)(()=>S.bind(rt.state(d=>l(void 0,{...d,ns:G("Just",n)})))(()=>fa(d=>{let $=i(d);return l((()=>{let g=$._1;return h=>({init:g,text:h})})(),$._2)})(o))))},xn=t=>ga(n=>{let r=mt(a=>f,a=>e=>G("Just",{head:a,tail:e}),n._1);if(r.tag==="Nothing")return A.pure(et("Done",n._2));if(r.tag==="Just"){if(r._1.head.tag==="NonRec"){let a=r._1.head._1.ident;return S.bind(Ia({ident:a,term:r._1.head._1.term}))(e=>A.pure(et("Loop",l(r._1.tail,{...n._2,text:e.text._1.code.length>0?Q(n._2.text)(e.text):n._2.text,init:[...n._2.init,...e.init],syms:a==="it"?n._2.syms:Q(n._2.syms)(a)}))))}if(r._1.head.tag==="Rec")return E("Not implemented!")}u()})(l(t.decls,{name:t.name,text:[],data:[],init:[],refs:[],syms:[]}));var Ft=(t,n)=>({tag:t,_1:n}),D=(t,n,r,a,e)=>({tag:t,_1:n,_2:r,_3:a,_4:e}),at=(t,n)=>({tag:t,_1:n});var Wn=at("P_i32_add"),jn=at("P_i32_sub");var kn=at("P_i32_le");var Un=at("P_log_not");function se(t){return new ArrayBuffer(t)}var pe=(t,n)=>({tag:t,_1:n}),ds=t=>pe("InpString",t),us=t=>pe("InpFile",t),Ra=t=>{let n=ut("Right",{dasmText:()=>"hoge",emitBin:(()=>{let r={name:"Sample",decls:[Ft("NonRec",{ident:"add",term:D("ELAbs",void 0,2,D("ELPrim",void 0,Wn,[D("ELVar",void 0,1),D("ELVar",void 0,0)]))}),Ft("NonRec",{ident:"f",term:D("ELAbs",void 0,1,D("ELLet",void 0,[D("ELAbs",void 0,1,D("ELPrim",void 0,jn,[D("ELVar",void 0,0),D("ELConst",void 0,yt("CstInt",1))])),D("ELApp",void 0,D("ELPrim",void 0,at("PGetGlobal","add"),[]),[D("ELConst",void 0,yt("CstInt",1))])],D("ELIf",void 0,D("ELPrim",void 0,Un,[D("ELPrim",void 0,kn,[D("ELVar",void 0,2),D("ELConst",void 0,yt("CstInt",0))])]),D("ELApp",void 0,D("ELVar",void 0,0),[D("ELVar",void 0,2)]),D("ELApp",void 0,D("ELVar",void 0,1),[D("ELVar",void 0,2)]))))}),Ft("NonRec",{ident:"it",term:D("ELApp",void 0,D("ELPrim",void 0,at("PGetGlobal","f"),[]),[D("ELConst",void 0,yt("CstInt",42))])})]};return mn(_n(xn(r)({moduleName:r.name,next:0,init:[],more:V,ns:f})._1))})()});return()=>n},$s=t=>{let n=Ra(pe("InpString",t));return()=>{let r=n();if(r.tag==="Left")return{success:!1,error:r._1,output:()=>se(0)};if(r.tag==="Right")return{success:!0,error:null,output:r._1.emitBin};u()}};export{pe as $CompileInput,us as InpFile,ds as InpString,Ra as compile,$s as compileJs};
